---
title: "co-expression"
author: "Andrew_Muir"
date: "8/22/2023"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Intro

Following on from 'differential all'(Cross-ref is skipped). This script delineates patterns of gene co-expression between our experimental conditions (differential co-expression) with the end goal of revealing putative causal networks. 

# Load packages and data

Packages
```{r load-packages}
library(SingleCellExperiment)
library(scater)
library(scran)
library(dcanr)
library(igraph)
library(EBcoexpress)
#library(GeneNet)#ggm dropped for slowness and poor performance
#library(COSINE)#Not available on the older R version used by compute cluster

set.seed(123)
```

Data
```{r load-data}
load('Data/sce_all_filt.RData')
```

Trim genes to be investigated. Either DE or HVGs. 
```{r gene-lists}
dim(sce_all_filt)
unique(sce_all_filt$condition)

# Remove forbidden rowData names (for generation of CompressedGRangesList)
names(rowData(sce_all_filt))[which(names(rowData(sce_all_filt))=="start")]="gene_start"
names(rowData(sce_all_filt))[which(names(rowData(sce_all_filt))=="end")]="gene_end"

# Swap ENSEMBL IDs for HGNC where possible for easy visualization
library(foreach)
library(doParallel)
#Assuming more than 2 cores, leaving 2 cores free
numCores <- detectCores(logical=FALSE) -2
registerDoParallel(numCores) 

BAL_genes_mix <- vector("list", length(rownames(sce_all_filt)))

BAL_genes_mix <- foreach (n=1:length(rownames(sce_all_filt))) %dopar%{
  if(rowData(sce_all_filt)$hgnc_symbol[n]==""){
    BAL_genes_mix[n] <- rownames(sce_all_filt)[n]
  } else {
    BAL_genes_mix[n] <- rowData(sce_all_filt)$hgnc_symbol[n]
  }}
stopImplicitCluster()

BAL_genes_mix <- as.character(BAL_genes_mix)
rownames(sce_all_filt) <- BAL_genes_mix

#HVGs
top_HVGs <- getTopHVGs(sce_all_filt, n=500)
#DE by clusters
DEs_byCluster <- findMarkers(sce_all_filt, groups=colData(sce_all_filt)$cluster)

cutoff <- 50
DEs_byCluster_shortlist <- NULL
DEs_byCluster_clusterlist <- NULL
for (n in 1:length(DEs_byCluster)){
  top_genes <- rownames(DEs_byCluster[[n]])[1:cutoff]
  DEs_byCluster_shortlist <- c(DEs_byCluster_shortlist, top_genes)
  cluster_list <- rep(names(DEs_byCluster)[n], length(top_genes))
  DEs_byCluster_clusterlist <- c(DEs_byCluster_clusterlist, cluster_list)
}
DEs_byCluster_df <- data.frame(matrix(NA, nrow = cutoff*length(DEs_byCluster), ncol = 2))
colnames(DEs_byCluster_df) <- c('cluster', 'top_genes')
DEs_byCluster_df$cluster <- DEs_byCluster_clusterlist
DEs_byCluster_df$top_genes <- DEs_byCluster_shortlist
DEs_byCluster_shortlist <- unique(DEs_byCluster_shortlist)

#DE by condition
DEs_byCondition <- findMarkers(sce_all_filt, groups=colData(sce_all_filt)$condition)

cutoff <- 100
DEs_byCondition_shortlist <- NULL
DEs_byCondition_Conditionlist <- NULL
for (n in 1:length(DEs_byCondition)){
  top_genes <- rownames(DEs_byCondition[[n]])[1:cutoff]
  DEs_byCondition_shortlist <- c(DEs_byCondition_shortlist, top_genes)
  Condition_list <- rep(names(DEs_byCondition)[n], length(top_genes))
  DEs_byCondition_Conditionlist <- c(DEs_byCondition_Conditionlist, Condition_list)
}
DEs_byCondition_df <- data.frame(matrix(NA, nrow = cutoff*length(DEs_byCondition), ncol = 2))
colnames(DEs_byCondition_df) <- c('Condition', 'top_genes')
DEs_byCondition_df$Condition <- DEs_byCondition_Conditionlist
DEs_byCondition_df$top_genes <- DEs_byCondition_shortlist
DEs_byCondition_shortlist <- unique(DEs_byCondition_shortlist)

```
First run will be verbose for demonstration, then create fast pipelines to quickly iterate and identify the best datasets and methods.

Compute DC scores
```{r DC-scores}
byCondition_INFvIL1B <- sce_all_filt[rownames(sce_all_filt) %in% DEs_byCondition_shortlist, ]
byCondition_INFvIL1B <- byCondition_INFvIL1B[, byCondition_INFvIL1B$condition %in% c("pH1N1", "Ad-HA/NP+Ad-IL1b")]

DC_scores_byCondition_INFvIL1B <- dcScore(emat=logcounts(byCondition_INFvIL1B), condition=byCondition_INFvIL1B$condition, dc.method='zscore', cor.method='spearman', ebcoexpress.useBWMC=FALSE)
```

Perform stats tests
```{r DC-stats}
raw_p_byCondition_INFvIL1B <- dcTest(DC_scores_byCondition_INFvIL1B, as.matrix(logcounts(byCondition_INFvIL1B)), condition=byCondition_INFvIL1B$condition)
```

Correct for multiple testing
```{r correct-multiple}
adj_p_byCondition_INFvIL1B <- dcAdjust(raw_p_byCondition_INFvIL1B, f = p.adjust, method = 'fdr')
```

Generate network
```{r generate-network}
dcnet_byCondition_INFvIL1B <- dcNetwork(DC_scores_byCondition_INFvIL1B, adj_p_byCondition_INFvIL1B)
plot(dcnet_byCondition_INFvIL1B, vertex.label = '', )
```
Edges are coloured based on the score (negative to positive scores are represented using the purple to green gradient of colours).
as adjacency matrix
```{r adjacency-matrix}
adjmat_byCondition_INFvIL1B <- as_adj(dcnet_byCondition_INFvIL1B, sparse = FALSE)
```

as dataframe
```{r dataframe}
edgedf_byCondition_INFvIL1B <- as_data_frame(dcnet_byCondition_INFvIL1B, what = 'edges')
```

pipelines for quick iteration and comparison of methods
```{r DC-pipelines}
#custom pipeline function
createDCnet <- function(emat, condition, dc.method, cor.method='spearman', ...) {
  #compute scores
  score = dcScore(logcounts(emat), condition, dc.method, cor.method=cor.method, ebcoexpress.useBWMC=FALSE,  ...)
  #perform statistical test
  pvals = dcTest(score, as.matrix(logcounts(emat)), condition, ...)
  #adjust tests for multiple testing
  adjp = dcAdjust(pvals, ...)
  #threshold and generate network
  dcnet = dcNetwork(score, adjp, ...)

  return(dcnet)
}
dcMethods()

get_cluster_genes <- function(cutoff, genelist=TRUE){
  DEs_byCluster_shortlist <- NULL
  DEs_byCluster_clusterlist <- NULL
  for (n in 1:length(DEs_byCluster)){
    top_genes <- rownames(DEs_byCluster[[n]])[1:cutoff]
    DEs_byCluster_shortlist <- c(DEs_byCluster_shortlist, top_genes)
    cluster_list <- rep(names(DEs_byCluster)[n], length(top_genes))
    DEs_byCluster_clusterlist <- c(DEs_byCluster_clusterlist, cluster_list)
  }
  DEs_byCluster_df <- data.frame(matrix(NA, nrow = cutoff*length(DEs_byCluster), ncol = 2))
  colnames(DEs_byCluster_df) <- c('cluster', 'top_genes')
  DEs_byCluster_df$cluster <- DEs_byCluster_clusterlist
  DEs_byCluster_df$top_genes <- DEs_byCluster_shortlist
  DEs_byCluster_shortlist <- unique(DEs_byCluster_shortlist)
  if (genelist==FALSE){
    return(DEs_byCluster_df)
  } else {
    return(DEs_byCluster_shortlist)
  }
}

get_condition_genes <- function(cutoff, genelist=TRUE){
  DEs_byCondition_shortlist <- NULL
  DEs_byCondition_Conditionlist <- NULL
  for (n in 1:length(DEs_byCondition)){
    top_genes <- rownames(DEs_byCondition[[n]])[1:cutoff]
    DEs_byCondition_shortlist <- c(DEs_byCondition_shortlist, top_genes)
    Condition_list <- rep(names(DEs_byCondition)[n], length(top_genes))
    DEs_byCondition_Conditionlist <- c(DEs_byCondition_Conditionlist, Condition_list)
  }
  DEs_byCondition_df <- data.frame(matrix(NA, nrow = cutoff*length(DEs_byCondition), ncol = 2))
  colnames(DEs_byCondition_df) <- c('Condition', 'top_genes')
  DEs_byCondition_df$Condition <- DEs_byCondition_Conditionlist
  DEs_byCondition_df$top_genes <- DEs_byCondition_shortlist
  DEs_byCondition_shortlist <- unique(DEs_byCondition_shortlist)
  if (genelist==FALSE){
    return(DEs_byCondition_df)
  } else {
    return(DEs_byCondition_shortlist)
  }
}

```

testing numerous iterations to find novel results
```{r trials1}
# cluster genes, PBS vs infected 
genes <- get_cluster_genes(10)
dataSCE <- sce_all_filt[rownames(sce_all_filt) %in% genes, ]
dataSCE <- dataSCE[, dataSCE$condition %in% c("pH1N1", "PBS")]
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="diffcoex"), vertex.label = '', main="diffcoex")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="ebcoexpress"), vertex.label = '', main="ebcoexpress")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="entropy"), vertex.label = '', main="entropy")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="magic"), vertex.label = '', main="magic")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="zscore"), vertex.label = '', main="zscore")

dcnet_zscore <- createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="zscore")
plot(subgraph(dcnet_zscore, 1:10))
plot(subgraph(dcnet_zscore, c("ANXA1", "CD74", "JCHAIN", "CD3E")))

```
try all genes **Heavy compute**
```{r trial2}
dataSCE <- sce_all_filt[, sce_all_filt$condition %in% c("pH1N1", "PBS")]
start <- Sys.time()
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="zscore"), vertex.label = '', main="zscore")
end <- Sys.time()
end-start

dataSCE <- sce_all_filt[, sce_all_filt$condition %in% c("Ad-HA/NP", "PBS")]
start <- Sys.time()
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="zscore"), vertex.label = '', main="zscore")
end <- Sys.time()
end-start

dataSCE <- sce_all_filt[, sce_all_filt$condition %in% c("Ad-HA/NP+Ad-IL1b", "PBS")]
start <- Sys.time()
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="zscore"), vertex.label = '', main="zscore")
end <- Sys.time()
end-start
```
try HVGs
```{r trial3}
genes <- getTopHVGs(sce_all_filt, n=100)
dataSCE <- sce_all_filt[rownames(sce_all_filt) %in% genes, ]
dataSCE <- dataSCE[, dataSCE$condition %in% c("pH1N1", "PBS")]
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="diffcoex"), vertex.label = '', main="diffcoex, HVG100, pH1N1")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="ebcoexpress"), vertex.label = '', main="ebcoexpress, HVG100, pH1N1")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="entropy"), vertex.label = '', main="entropy, HVG100, pH1N1")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="magic"), vertex.label = '', main="magic, HVG100, pH1N1")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="zscore"), vertex.label = '', main="zscore, HVG100, pH1N1")

genes <- getTopHVGs(sce_all_filt, n=500)
dataSCE <- sce_all_filt[rownames(sce_all_filt) %in% genes, ]
dataSCE <- dataSCE[, dataSCE$condition %in% c("pH1N1", "PBS")]
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="diffcoex"), vertex.label = '', main="diffcoex, HVG500, pH1N1")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="ebcoexpress"), vertex.label = '', main="ebcoexpress, HVG500, pH1N1")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="entropy"), vertex.label = '', main="entropy, HVG500, pH1N1")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="magic"), vertex.label = '', main="magic, HVG500, pH1N1")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="zscore"), vertex.label = '', main="zscore, HVG500, pH1N1")

genes <- getTopHVGs(sce_all_filt, n=100)
dataSCE <- sce_all_filt[rownames(sce_all_filt) %in% genes, ]
dataSCE <- dataSCE[, dataSCE$condition %in% c("Ad-HA/NP+Ad-IL1b", "PBS")]
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="diffcoex"), vertex.label = '', main="diffcoex, HVG100, Ad-HA/NP+Ad-IL1b")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="ebcoexpress"), vertex.label = '', main="ebcoexpress, HVG100, Ad-HA/NP+Ad-IL1b")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="entropy"), vertex.label = '', main="entropy, HVG100, Ad-HA/NP+Ad-IL1b")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="magic"), vertex.label = '', main="magic, HVG100, Ad-HA/NP+Ad-IL1b")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="zscore"), vertex.label = '', main="zscore, HVG100, Ad-HA/NP+Ad-IL1b")

genes <- getTopHVGs(sce_all_filt, n=500)
dataSCE <- sce_all_filt[rownames(sce_all_filt) %in% genes, ]
dataSCE <- dataSCE[, dataSCE$condition %in% c("Ad-HA/NP+Ad-IL1b", "PBS")]
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="diffcoex"), vertex.label = '', main="diffcoex, HVG500, Ad-HA/NP+Ad-IL1b")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="ebcoexpress"), vertex.label = '', main="ebcoexpress, HVG500, Ad-HA/NP+Ad-IL1b")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="entropy"), vertex.label = '', main="entropy, HVG500, Ad-HA/NP+Ad-IL1b")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="magic"), vertex.label = '', main="magic, HVG500, Ad-HA/NP+Ad-IL1b")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="zscore"), vertex.label = '', main="zscore, HVG500, Ad-HA/NP+Ad-IL1b")

genes <- getTopHVGs(sce_all_filt, n=100)
dataSCE <- sce_all_filt[rownames(sce_all_filt) %in% genes, ]
dataSCE <- dataSCE[, dataSCE$condition %in% c("pH1N1", "Ad-HA/NP+Ad-IL1b")]
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="diffcoex"), vertex.label = '', main="diffcoex, HVG100, infected vs vaccine+adjuvant")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="ebcoexpress"), vertex.label = '', main="ebcoexpress, HVG100, infected vs vaccine+adjuvant")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="entropy"), vertex.label = '', main="entropy, HVG100, infected vs vaccine+adjuvant")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="magic"), vertex.label = '', main="magic, HVG100, infected vs vaccine+adjuvant")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="zscore"), vertex.label = '', main="zscore, HVG100, infected vs vaccine+adjuvant")

genes <- getTopHVGs(sce_all_filt, n=500)
dataSCE <- sce_all_filt[rownames(sce_all_filt) %in% genes, ]
dataSCE <- dataSCE[, dataSCE$condition %in% c("pH1N1", "Ad-HA/NP+Ad-IL1b")]
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="diffcoex"), vertex.label = '', main="diffcoex, HVG500, infected vs vaccine+adjuvant")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="ebcoexpress"), vertex.label = '', main="ebcoexpress, HVG500, infected vs vaccine+adjuvant")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="entropy"), vertex.label = '', main="entropy, HVG500, infected vs vaccine+adjuvant")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="magic"), vertex.label = '', main="magic, HVG500, infected vs vaccine+adjuvant")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="zscore"), vertex.label = '', main="zscore, HVG500, infected vs vaccine+adjuvant")

```
more HVGs
```{r trial4}
genes <- getTopHVGs(sce_all_filt, n=1000)
dataSCE <- sce_all_filt[rownames(sce_all_filt) %in% genes, ]
dataSCE <- dataSCE[, dataSCE$condition %in% c("pH1N1", "PBS")]
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="diffcoex"), vertex.label = '', main="diffcoex, HVG1000, pH1N1")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="ebcoexpress"), vertex.label = '', main="ebcoexpress, HVG1000, pH1N1")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="entropy"), vertex.label = '', main="entropy, HVG1000, pH1N1")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="magic"), vertex.label = '', main="magic, HVG1000, pH1N1")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="zscore"), vertex.label = '', main="zscore, HVG1000, pH1N1")

genes <- getTopHVGs(sce_all_filt, n=5000)
dataSCE <- sce_all_filt[rownames(sce_all_filt) %in% genes, ]
dataSCE <- dataSCE[, dataSCE$condition %in% c("pH1N1", "PBS")]
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="diffcoex"), vertex.label = '', main="diffcoex, HVG5000, pH1N1")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="ebcoexpress"), vertex.label = '', main="ebcoexpress, HVG5000, pH1N1")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="entropy"), vertex.label = '', main="entropy, HVG5000, pH1N1")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="magic"), vertex.label = '', main="magic, HVG5000, pH1N1")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="zscore"), vertex.label = '', main="zscore, HVG5000, pH1N1")

genes <- getTopHVGs(sce_all_filt, n=1000)
dataSCE <- sce_all_filt[rownames(sce_all_filt) %in% genes, ]
dataSCE <- dataSCE[, dataSCE$condition %in% c("Ad-HA/NP+Ad-IL1b", "PBS")]
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="diffcoex"), vertex.label = '', main="diffcoex, HVG1000, Ad-HA/NP+Ad-IL1b")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="ebcoexpress"), vertex.label = '', main="ebcoexpress, HVG1000, Ad-HA/NP+Ad-IL1b")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="entropy"), vertex.label = '', main="entropy, HVG1000, Ad-HA/NP+Ad-IL1b")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="magic"), vertex.label = '', main="magic, HVG1000, Ad-HA/NP+Ad-IL1b")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="zscore"), vertex.label = '', main="zscore, HVG1000, Ad-HA/NP+Ad-IL1b")

genes <- getTopHVGs(sce_all_filt, n=5000)
dataSCE <- sce_all_filt[rownames(sce_all_filt) %in% genes, ]
dataSCE <- dataSCE[, dataSCE$condition %in% c("Ad-HA/NP+Ad-IL1b", "PBS")]
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="diffcoex"), vertex.label = '', main="diffcoex, HVG5000, Ad-HA/NP+Ad-IL1b")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="ebcoexpress"), vertex.label = '', main="ebcoexpress, HVG5000, Ad-HA/NP+Ad-IL1b")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="entropy"), vertex.label = '', main="entropy, HVG5000, Ad-HA/NP+Ad-IL1b")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="magic"), vertex.label = '', main="magic, HVG5000, Ad-HA/NP+Ad-IL1b")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="zscore"), vertex.label = '', main="zscore, HVG5000, Ad-HA/NP+Ad-IL1b")

genes <- getTopHVGs(sce_all_filt, n=1000)
dataSCE <- sce_all_filt[rownames(sce_all_filt) %in% genes, ]
dataSCE <- dataSCE[, dataSCE$condition %in% c("pH1N1", "Ad-HA/NP+Ad-IL1b")]
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="diffcoex"), vertex.label = '', main="diffcoex, HVG1000, infected vs vaccine+adjuvant")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="ebcoexpress"), vertex.label = '', main="ebcoexpress, HVG1000, infected vs vaccine+adjuvant")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="entropy"), vertex.label = '', main="entropy, HVG1000, infected vs vaccine+adjuvant")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="magic"), vertex.label = '', main="magic, HVG1000, infected vs vaccine+adjuvant")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="zscore"), vertex.label = '', main="zscore, HVG1000, infected vs vaccine+adjuvant")

genes <- getTopHVGs(sce_all_filt, n=500)
dataSCE <- sce_all_filt[rownames(sce_all_filt) %in% genes, ]
dataSCE <- dataSCE[, dataSCE$condition %in% c("pH1N1", "Ad-HA/NP+Ad-IL1b")]
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="diffcoex"), vertex.label = '', main="diffcoex, HVG5000, infected vs vaccine+adjuvant")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="ebcoexpress"), vertex.label = '', main="ebcoexpress, HVG5000, infected vs vaccine+adjuvant")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="entropy"), vertex.label = '', main="entropy, HVG5000, infected vs vaccine+adjuvant")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="magic"), vertex.label = '', main="magic, HVG5000, infected vs vaccine+adjuvant")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="zscore"), vertex.label = '', main="zscore, HVG5000, infected vs vaccine+adjuvant")
```
try cluster genes
```{r trial5}
genes <- get_cluster_genes(50)
dataSCE <- sce_all_filt[rownames(sce_all_filt) %in% genes, ]
dataSCE <- dataSCE[, dataSCE$condition %in% c("pH1N1", "PBS")]
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="diffcoex"), vertex.label = '', main="diffcoex, cluster50, pH1N1")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="ebcoexpress"), vertex.label = '', main="ebcoexpress, cluster50, pH1N1")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="entropy"), vertex.label = '', main="entropy, cluster50, pH1N1")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="magic"), vertex.label = '', main="magic, cluster50, pH1N1")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="zscore"), vertex.label = '', main="zscore, cluster50, pH1N1")

genes <- get_cluster_genes(100)
dataSCE <- sce_all_filt[rownames(sce_all_filt) %in% genes, ]
dataSCE <- dataSCE[, dataSCE$condition %in% c("pH1N1", "PBS")]
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="diffcoex"), vertex.label = '', main="diffcoex, cluster100, pH1N1")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="ebcoexpress"), vertex.label = '', main="ebcoexpress, cluster100, pH1N1")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="entropy"), vertex.label = '', main="entropy, cluster100, pH1N1")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="magic"), vertex.label = '', main="magic, cluster100, pH1N1")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="zscore"), vertex.label = '', main="zscore, cluster100, pH1N1")

genes <- get_cluster_genes(50)
dataSCE <- sce_all_filt[rownames(sce_all_filt) %in% genes, ]
dataSCE <- dataSCE[, dataSCE$condition %in% c("Ad-HA/NP+Ad-IL1b", "PBS")]
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="diffcoex"), vertex.label = '', main="diffcoex, cluster50, Ad-HA/NP+Ad-IL1b")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="ebcoexpress"), vertex.label = '', main="ebcoexpress, cluster50 Ad-HA/NP+Ad-IL1b")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="entropy"), vertex.label = '', main="entropy, cluster50, Ad-HA/NP+Ad-IL1b")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="magic"), vertex.label = '', main="magic, cluster50, Ad-HA/NP+Ad-IL1b")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="zscore"), vertex.label = '', main="zscore, cluster50, Ad-HA/NP+Ad-IL1b")

genes <- get_cluster_genes(100)
dataSCE <- sce_all_filt[rownames(sce_all_filt) %in% genes, ]
dataSCE <- dataSCE[, dataSCE$condition %in% c("Ad-HA/NP+Ad-IL1b", "PBS")]
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="diffcoex"), vertex.label = '', main="diffcoex, cluster100, Ad-HA/NP+Ad-IL1b")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="ebcoexpress"), vertex.label = '', main="ebcoexpress, cluster100, Ad-HA/NP+Ad-IL1b")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="entropy"), vertex.label = '', main="entropy, cluster100, Ad-HA/NP+Ad-IL1b")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="magic"), vertex.label = '', main="magic, cluster100, Ad-HA/NP+Ad-IL1b")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="zscore"), vertex.label = '', main="zscore, cluster100, Ad-HA/NP+Ad-IL1b")

genes <- get_cluster_genes(50)
dataSCE <- sce_all_filt[rownames(sce_all_filt) %in% genes, ]
dataSCE <- dataSCE[, dataSCE$condition %in% c("pH1N1", "Ad-HA/NP+Ad-IL1b")]
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="diffcoex"), vertex.label = '', main="diffcoex, cluster50, infected vs vaccine+adjuvant")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="ebcoexpress"), vertex.label = '', main="ebcoexpress, cluster50, infected vs vaccine+adjuvant")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="entropy"), vertex.label = '', main="entropy, cluster50, infected vs vaccine+adjuvant")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="magic"), vertex.label = '', main="magic, cluster50, infected vs vaccine+adjuvant")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="zscore"), vertex.label = '', main="zscore, cluster50, infected vs vaccine+adjuvant")

genes <- get_cluster_genes(100)
dataSCE <- sce_all_filt[rownames(sce_all_filt) %in% genes, ]
dataSCE <- dataSCE[, dataSCE$condition %in% c("pH1N1", "Ad-HA/NP+Ad-IL1b")]
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="diffcoex"), vertex.label = '', main="diffcoex, cluster100, infected vs vaccine+adjuvant")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="ebcoexpress"), vertex.label = '', main="ebcoexpress, cluster100, infected vs vaccine+adjuvant")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="entropy"), vertex.label = '', main="entropy, cluster100, infected vs vaccine+adjuvant")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="magic"), vertex.label = '', main="magic, cluster100, infected vs vaccine+adjuvant")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="zscore"), vertex.label = '', main="zscore, cluster100, infected vs vaccine+adjuvant")
```
try condition genes
```{r trial6}
genes <- get_condition_genes(50)
dataSCE <- sce_all_filt[rownames(sce_all_filt) %in% genes, ]
dataSCE <- dataSCE[, dataSCE$condition %in% c("pH1N1", "PBS")]
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="diffcoex"), vertex.label = '', main="diffcoex, condition50, pH1N1")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="ebcoexpress"), vertex.label = '', main="ebcoexpress, condition50, pH1N1")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="entropy"), vertex.label = '', main="entropy, condition50, pH1N1")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="magic"), vertex.label = '', main="magic, condition50, pH1N1")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="zscore"), vertex.label = '', main="zscore, condition50, pH1N1")

genes <- get_condition_genes(100)
dataSCE <- sce_all_filt[rownames(sce_all_filt) %in% genes, ]
dataSCE <- dataSCE[, dataSCE$condition %in% c("pH1N1", "PBS")]
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="diffcoex"), vertex.label = '', main="diffcoex, condition100, pH1N1")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="ebcoexpress"), vertex.label = '', main="ebcoexpress, condition100, pH1N1")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="entropy"), vertex.label = '', main="entropy, condition100, pH1N1")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="magic"), vertex.label = '', main="magic, condition100, pH1N1")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="zscore"), vertex.label = '', main="zscore, condition100, pH1N1")

genes <- get_condition_genes(50)
dataSCE <- sce_all_filt[rownames(sce_all_filt) %in% genes, ]
dataSCE <- dataSCE[, dataSCE$condition %in% c("Ad-HA/NP+Ad-IL1b", "PBS")]
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="diffcoex"), vertex.label = '', main="diffcoex, condition50, Ad-HA/NP+Ad-IL1b")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="ebcoexpress"), vertex.label = '', main="ebcoexpress, condition50, Ad-HA/NP+Ad-IL1b")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="entropy"), vertex.label = '', main="entropy, condition50, Ad-HA/NP+Ad-IL1b")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="magic"), vertex.label = '', main="magic, condition50, Ad-HA/NP+Ad-IL1b")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="zscore"), vertex.label = '', main="zscore, condition50, Ad-HA/NP+Ad-IL1b")

genes <- get_condition_genes(100)
dataSCE <- sce_all_filt[rownames(sce_all_filt) %in% genes, ]
dataSCE <- dataSCE[, dataSCE$condition %in% c("Ad-HA/NP+Ad-IL1b", "PBS")]
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="diffcoex"), vertex.label = '', main="diffcoex, condition100, Ad-HA/NP+Ad-IL1b")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="ebcoexpress"), vertex.label = '', main="ebcoexpress, condition100, Ad-HA/NP+Ad-IL1b")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="entropy"), vertex.label = '', main="entropy, condition100, Ad-HA/NP+Ad-IL1b")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="magic"), vertex.label = '', main="magic, condition100, Ad-HA/NP+Ad-IL1b")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="zscore"), vertex.label = '', main="zscore, condition100, Ad-HA/NP+Ad-IL1b")

genes <- get_condition_genes(50)
dataSCE <- sce_all_filt[rownames(sce_all_filt) %in% genes, ]
dataSCE <- dataSCE[, dataSCE$condition %in% c("pH1N1", "Ad-HA/NP+Ad-IL1b")]
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="diffcoex"), vertex.label = '', main="diffcoex, condition50, infected vs vaccine+adjuvant")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="ebcoexpress"), vertex.label = '', main="ebcoexpress, condition50, infected vs vaccine+adjuvant")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="entropy"), vertex.label = '', main="entropy, condition50, infected vs vaccine+adjuvant")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="magic"), vertex.label = '', main="magic, condition50, infected vs vaccine+adjuvant")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="zscore"), vertex.label = '', main="zscore, condition50, infected vs vaccine+adjuvant")

genes <- get_condition_genes(100)
dataSCE <- sce_all_filt[rownames(sce_all_filt) %in% genes, ]
dataSCE <- dataSCE[, dataSCE$condition %in% c("pH1N1", "Ad-HA/NP+Ad-IL1b")]
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="diffcoex"), vertex.label = '', main="diffcoex, condition100, infected vs vaccine+adjuvant")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="ebcoexpress"), vertex.label = '', main="ebcoexpress, condition100, infected vs vaccine+adjuvant")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="entropy"), vertex.label = '', main="entropy, condition100, infected vs vaccine+adjuvant")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="magic"), vertex.label = '', main="magic, condition100, infected vs vaccine+adjuvant")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="zscore"), vertex.label = '', main="zscore, condition100, infected vs vaccine+adjuvant")
```
try individual cell-types/clusters
```{r trial7}
# B cells
cluster_gene_df <- get_cluster_genes(50, genelist=FALSE)

B_Cell_genes <- cluster_gene_df[grep(pattern=c("12|16"), x=cluster_gene_df$cluster), ]
B_Cell_genes <- unique(B_Cell_genes$top_genes)

dataSCE <- sce_all_filt[rownames(sce_all_filt) %in% B_Cell_genes, ]
dataSCE <- dataSCE[, dataSCE$cluster %in% c("12", "16")]
dataSCE <- dataSCE[, dataSCE$condition %in% c("pH1N1", "PBS")]
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="diffcoex"), vertex.label = '', main="diffcoex, Bcells, pH1N1")
#plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="ebcoexpress"), vertex.label = '', main="ebcoexpress, Bcells, pH1N1")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="entropy"), vertex.label = '', main="entropy, Bcells, pH1N1")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="magic"), vertex.label = '', main="magic, Bcells, pH1N1")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="zscore"), vertex.label = '', main="zscore, Bcells, pH1N1")

dataSCE <- sce_all_filt[rownames(sce_all_filt) %in% B_Cell_genes, ]
dataSCE <- dataSCE[, dataSCE$cluster %in% c("12", "16")]
dataSCE <- dataSCE[, dataSCE$condition %in% c("pH1N1", "Ad-HA/NP+Ad-IL1b")]
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="diffcoex"), vertex.label = '', main="diffcoex, Bcells, infected vs vaccine+adjuvant")
#plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="ebcoexpress"), vertex.label = '', main="ebcoexpress, Bcells, infected vs vaccine+adjuvant")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="entropy"), vertex.label = '', main="entropy, Bcells, infected vs vaccine+adjuvant")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="magic"), vertex.label = '', main="magic, Bcells, infected vs vaccine+adjuvant")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="zscore"), vertex.label = '', main="zscore, Bcells, infected vs vaccine+adjuvant")

#Tregs
Treg_genes <- cluster_gene_df[grep(pattern=c("10"), x=cluster_gene_df$cluster), ]
Treg_genes <- unique(Treg_genes$top_genes)

dataSCE <- sce_all_filt[rownames(sce_all_filt) %in% Treg_genes, ]
dataSCE <- dataSCE[, dataSCE$cluster %in% c("10")]
dataSCE <- dataSCE[, dataSCE$condition %in% c("pH1N1", "PBS")]
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="diffcoex"), vertex.label = '', main="diffcoex, Tregs, pH1N1")
#plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="ebcoexpress"), vertex.label = '', main="ebcoexpress, Tregs, pH1N1")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="entropy"), vertex.label = '', main="entropy, Tregs, pH1N1")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="magic"), vertex.label = '', main="magic, Tregs, pH1N1")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="zscore"), vertex.label = '', main="zscore, Tregs, pH1N1")

dataSCE <- sce_all_filt[rownames(sce_all_filt) %in% Treg_genes, ]
dataSCE <- dataSCE[, dataSCE$cluster %in% c("10")]
dataSCE <- dataSCE[, dataSCE$condition %in% c("pH1N1", "Ad-HA/NP+Ad-IL1b")]
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="diffcoex"), vertex.label = '', main="diffcoex, Tregs, infected vs vaccine+adjuvant")
#plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="ebcoexpress"), vertex.label = '', main="ebcoexpress, Tregs, infected vs vaccine+adjuvant")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="entropy"), vertex.label = '', main="entropy, Tregs, infected vs vaccine+adjuvant")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="magic"), vertex.label = '', main="magic, Tregs, infected vs vaccine+adjuvant")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="zscore"), vertex.label = '', main="zscore, Tregs, infected vs vaccine+adjuvant")

#Macrophages
macrophage_genes <- cluster_gene_df[grep(pattern=c("1|4|8"), x=cluster_gene_df$cluster), ]
macrophage_genes <- unique(macrophage_genes$top_genes)

dataSCE <- sce_all_filt[rownames(sce_all_filt) %in% macrophage_genes, ]
dataSCE <- dataSCE[, dataSCE$cluster %in% c("1", "4", "8")]
dataSCE <- dataSCE[, dataSCE$condition %in% c("pH1N1", "Ad-HA/NP+Ad-IL1b")]
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="diffcoex"), vertex.label = '', main="diffcoex, Macrophages, infected vs vaccine+adjuvant")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="ebcoexpress"), vertex.label = '', main="ebcoexpress, Macrophages, infected vs vaccine+adjuvant")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="entropy"), vertex.label = '', main="entropy, Macrophages, infected vs vaccine+adjuvant")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="magic"), vertex.label = '', main="magic, Macrophages, infected vs vaccine+adjuvant")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="zscore"), vertex.label = '', main="zscore, Macrophages, infected vs vaccine+adjuvant")

```
cell-types by condition
```{r trial8}
genes <- get_condition_genes(5)
#B cells
dataSCE <- sce_all_filt[rownames(sce_all_filt) %in% genes, ]
dataSCE <- dataSCE[, dataSCE$cluster %in% c("12", "16")]
dataSCE <- dataSCE[, dataSCE$condition %in% c("pH1N1", "PBS")]
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="diffcoex"), vertex.label.dist=2, edge.width=3, vertex.size=10, main="diffcoex, Bcells, pH1N1")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="entropy"), vertex.label.dist=2, vertex.size=10, edge.width=3, main="entropy, Bcells, pH1N1")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="magic"), vertex.label.dist=2, vertex.size=10, edge.width=3, main="magic, Bcells, pH1N1")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="zscore"), vertex.label.dist=2, vertex.size=10, edge.width=3, main="zscore, Bcells, pH1N1")

dataSCE <- sce_all_filt[rownames(sce_all_filt) %in% genes, ]
dataSCE <- dataSCE[, dataSCE$cluster %in% c("12", "16")]
dataSCE <- dataSCE[, dataSCE$condition %in% c("pH1N1", "Ad-HA/NP+Ad-IL1b")]
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="diffcoex"), vertex.label.dist=2, vertex.size=10, edge.width=3, main="diffcoex, Bcells, infected vs vaccine+adjuvant")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="entropy"),  vertex.label.dist=2, vertex.size=10, edge.width=3, main="entropy, Bcells, infected vs vaccine+adjuvant")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="magic"),  vertex.label.dist=2, vertex.size=10, edge.width=3, main="magic, Bcells, infected vs vaccine+adjuvant")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="zscore"),  vertex.label.dist=2, vertex.size=10, edge.width=3, main="zscore, Bcells, infected vs vaccine+adjuvant")

#Tregs
dataSCE <- sce_all_filt[rownames(sce_all_filt) %in% genes, ]
dataSCE <- dataSCE[, dataSCE$cluster %in% c("10")]
dataSCE <- dataSCE[, dataSCE$condition %in% c("pH1N1", "PBS")]
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="diffcoex"),  vertex.label.dist=2, vertex.size=10, edge.width=3, main="diffcoex, Tregs, pH1N1")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="entropy"),  vertex.label.dist=2, vertex.size=10, edge.width=3, main="entropy, Tregs, pH1N1")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="magic"),  vertex.label.dist=2, vertex.size=10, edge.width=3, main="magic, Tregs, pH1N1")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="zscore"),  vertex.label.dist=2, vertex.size=10, edge.width=3, main="zscore, Tregs, pH1N1")

dataSCE <- sce_all_filt[rownames(sce_all_filt) %in% genes, ]
dataSCE <- dataSCE[, dataSCE$cluster %in% c("10")]
dataSCE <- dataSCE[, dataSCE$condition %in% c("pH1N1", "Ad-HA/NP+Ad-IL1b")]
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="diffcoex"),  vertex.label.dist=2, vertex.size=10, edge.width=3, main="diffcoex, Tregs, infected vs vaccine+adjuvant")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="entropy"),  vertex.label.dist=2, vertex.size=10, edge.width=3, main="entropy, Tregs, infected vs vaccine+adjuvant")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="magic"),  vertex.label.dist=2, vertex.size=10, edge.width=3, main="magic, Tregs, infected vs vaccine+adjuvant")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="zscore"),  vertex.label.dist=2, vertex.size=10, edge.width=3, main="zscore, Tregs, infected vs vaccine+adjuvant")

#Macrophages
dataSCE <- sce_all_filt[rownames(sce_all_filt) %in% genes, ]
dataSCE <- dataSCE[, dataSCE$cluster %in% c("1", "4", "8")]
dataSCE <- dataSCE[, dataSCE$condition %in% c("pH1N1", "Ad-HA/NP+Ad-IL1b")]
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="diffcoex"),  vertex.label.dist=2, vertex.size=10, edge.width=3, main="diffcoex, Macrophages, infected vs vaccine+adjuvant")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="ebcoexpress"),  vertex.label.dist=2, vertex.size=10, edge.width=3, main="ebcoexpress, Macrophages, infected vs vaccine+adjuvant")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="entropy"),  vertex.label.dist=2, vertex.size=10, edge.width=3, main="entropy, Macrophages, infected vs vaccine+adjuvant")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="magic"),  vertex.label.dist=2, vertex.size=10, edge.width=3, main="magic, Macrophages, infected vs vaccine+adjuvant")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="zscore"),  vertex.label.dist=2, vertex.size=10, edge.width=3, main="zscore, Macrophages, infected vs vaccine+adjuvant")
```
try IFI6 centred
```{r trial9}
genes <- get_condition_genes(10)

#CD8 T cells
dataSCE <- sce_all_filt[rownames(sce_all_filt) %in% genes, ]
dataSCE <- dataSCE[, dataSCE$cluster %in% c("6", "20b", "18a", "9a")]
dataSCE <- dataSCE[, dataSCE$condition %in% c("pH1N1", "Ad-HA/NP+Ad-IL1b")]
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="entropy"),  vertex.label.dist=2, vertex.size=10, edge.width=3, main="entropy, Macrophages, infected vs vaccine+adjuvant")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="magic"),  vertex.label.dist=2, vertex.size=10, edge.width=3, main="magic, Macrophages, infected vs vaccine+adjuvant")
plot(createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="zscore"),  vertex.label.dist=2, vertex.size=10, edge.width=3, main="zscore, Macrophages, infected vs vaccine+adjuvant")

test1 <- createDCnet(emat=dataSCE, condition=dataSCE$condition, dc.method="zscore")
sub_g = make_ego_graph(test1, order=1, mode="in", node="IFI6", mindist=0)[[1]]
plot(test1, vertex.label.dist=2, vertex.size=10, edge.width=3)
plot(sub_g, vertex.label.dist=2, vertex.size=10, edge.width=3)

```

